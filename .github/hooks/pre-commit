#!/bin/bash

declare -A files=(
    ["../src/tests/test-subcommands.ts"]="./baseline.test-subcommands.txt"
    ["../src/tests/test.commands.ts"]="./baseline.test.commands.txt"
    ["../src/tests/test.handler.ts"]="./baseline.test.handler.txt"
)

for FILE in "${!files[@]}"; do
    TEMPLATE="${files[$FILE]}"

    # Ensure template exists
    if [[ ! -f "$TEMPLATE" ]]; then
        echo "Missing baseline template: $TEMPLATE"
        exit 1
    fi

    # Compare working file to template
    if ! cmp -s "$FILE" "$TEMPLATE"; then
        echo "Warning: $FILE has been modified from its baseline. It will not be committed."

        # Unstage the file if it's staged
        git reset -- "$FILE"

        # Tell Git to ignore further local changes
        git update-index --assume-unchanged "$FILE"
    fi
done
